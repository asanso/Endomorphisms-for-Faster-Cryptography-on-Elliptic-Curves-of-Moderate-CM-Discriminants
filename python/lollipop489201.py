import sage.all
from sage.all import FractionField
from sage.rings.integer_ring import Z as ZZ
from sage.matrix.constructor import Matrix
from sage.modules.free_module_element import free_module_element as vector
from curve import WeierstrassCurve
from curve import PointWeierstrass

class  Lollipop489201(WeierstrassCurve):

       def __init__(self, p, a, b, r, cofactor,L):
            super().__init__(p, a,b, r, cofactor)
            self.D = -547
            self.L = L
            self.cofactor = cofactor
            self.r = r
            M = Matrix([[-L,1], [r,0]])
            self.N = M.LLL()
            self.N_inv = self.N**-1
            self.Fpxy = self.Fp['x', 'y']
            self.FpXY = FractionField(self.Fpxy)
            x, y = self.FpXY.gens()
            self.x0_map = (x**11 + 344959091081700922598753234080208529238293783251065431047762*x**10 + 618656784706780202005835730745508498961394889899594573602133*x**9 + 345046775957625697537452490799924294023258841238858303398288*x**8 + 329474990218736431418333824967260937394458529551615570946491*x**7 + 691728297863296108633527868364274276540466958086067387095638*x**6 + 1357990828765921024869300783866802391624650241598296038729547*x**5 + 1685216347350882591326020390968131766626485131724987747810528*x**4 + 1731680257507500767922993247383625512641276166785391715703265*x**3 + 206258873338213133803988372492280260862220393203645177382245*x**2 + 196909889892527505195484041589754696597614298956718028744136*x + 73521355122320838166117586475381237055438418773047977432418)/(x**10 + 344959091081700922598753234080208529238293783251065431047762*x**9 + 352206763105908364536525348823514096225834345932995725877219*x**8 + 1695504367068528763531374852931338650240409735184673879453190*x**7 + 1554766224953940578561535963601254196374826673521628393510673*x**6 + 713756646364889744922619364491054959936101349245024037005080*x**5 + 175213194816461071782468817950244523852037975793395744465459*x**4 + 458041619840079561526774390340896744813640059447166396713262*x**3 + 434818279101297896759676143702454744440592746076302229341350*x**2 + 495373531680873851138512740297031175502347015531087253549186*x + 516081654464090886604019685633066413036969723657457805496148)


class Lollipop489201Point(PointWeierstrass):
      
        def fast_scalar_mul(self, n):
            psiP = self.psi()
            beta = vector([n,0]) * self.curve.N_inv
            b = vector([int(beta[0]), int(beta[1])]) * self.curve.N
            k1 = n-b[0]
            k2 = -b[1]
            return self.multi_scalar_mul(k1, psiP, k2)