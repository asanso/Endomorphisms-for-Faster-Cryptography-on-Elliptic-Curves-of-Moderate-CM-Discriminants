import sage.all
from sage.all import FractionField
from sage.rings.integer_ring import Z as ZZ
from sage.matrix.constructor import Matrix
from sage.modules.free_module_element import free_module_element as vector
from curve import WeierstrassCurve
from curve import PointWeierstrass

class  Lollipop489201(WeierstrassCurve):

       def __init__(self, p, a, b, r, cofactor,L):
            super().__init__(p, a,b, r, cofactor)
            self.D = -547
            self.L = L
            self.cofactor = cofactor
            self.r = r
            M = Matrix([[-L,1], [r,0]])
            self.N = M.LLL()
            self.N_inv = self.N**-1
            self.Fpxy = self.Fp['x', 'y']
            self.FpXY = FractionField(self.Fpxy)
            x, y = self.FpXY.gens()
            self.x0_map = (x**11 + 344959091081700922598753234080208529238293783251065431047762*x**10 + 618656784706780202005835730745508498961394889899594573602133*x**9 + 345046775957625697537452490799924294023258841238858303398288*x**8 + 329474990218736431418333824967260937394458529551615570946491*x**7 + 691728297863296108633527868364274276540466958086067387095638*x**6 + 1357990828765921024869300783866802391624650241598296038729547*x**5 + 1685216347350882591326020390968131766626485131724987747810528*x**4 + 1731680257507500767922993247383625512641276166785391715703265*x**3 + 206258873338213133803988372492280260862220393203645177382245*x**2 + 196909889892527505195484041589754696597614298956718028744136*x + 73521355122320838166117586475381237055438418773047977432418)/(x**10 + 344959091081700922598753234080208529238293783251065431047762*x**9 + 352206763105908364536525348823514096225834345932995725877219*x**8 + 1695504367068528763531374852931338650240409735184673879453190*x**7 + 1554766224953940578561535963601254196374826673521628393510673*x**6 + 713756646364889744922619364491054959936101349245024037005080*x**5 + 175213194816461071782468817950244523852037975793395744465459*x**4 + 458041619840079561526774390340896744813640059447166396713262*x**3 + 434818279101297896759676143702454744440592746076302229341350*x**2 + 495373531680873851138512740297031175502347015531087253549186*x + 516081654464090886604019685633066413036969723657457805496148)
            self.y0_map = (x**15*y + 517438636622551383898129851120312793857440674876598146571643*x**14*y + 1422805883596174815897152555190191305231430178199889242864234*x**13*y + 1235830203396332037342231702584403457060140993768197357746200*x**12*y + 1167158140851704127267172514520448125703155271915952985411840*x**11*y + 456048028442012048627378561237883653662609805799893458863180*x**10*y + 1534336943728983425292386694750981729344544471154362735643661*x**9*y + 711772070484181506589990348964463770754736827247877029827955*x**8*y + 1683757980840900324661482267629579663984837987483223179178481*x**7*y + 912226166872639571476828563993659630303059718942536037154585*x**6*y + 812804831647521380827713151385824707104134522078992566134775*x**5*y + 1269070611714168808805831756997274848818655773786457230641707*x**4*y + 631191777072740644729159478367012612095051457616463979190485*x**3*y + 726052255759378714070536380160393013950206642992737462675985*x**2*y + 1435966611309991001234369342698537076900972744407002246922282*x*y + 704184042616084674633071720690470858279640440021930108424115*y)/(x**15 + 517438636622551383898129851120312793857440674876598146571643*x**14 + 1689255905197046653366462937112185707966990722166488090589148*x**13 + 34184037023971003773513558157493389356190589711706974158149*x**12 + 194939472451628947553677133271819755265242139331575826191037*x**11 + 746860776195678464781702814837297514039620557481234570265595*x**10 + 245689221103848566439197527045061433678041811274024299542282*x**9 + 791698389953916123455561934848960593509116352014720763520985*x**8 + 1714039539474161075262684821036280740359688180554080022946109*x**7 + 974758460415018235105122873304820941738705495115246742896025*x**6 + 157593574622784075069994530838464719574945254591144557657770*x**5 + 1437124048537544763886933410010839295836389506437768612605644*x**4 + 1322867069493606242684309427454639040503730401885301513206879*x**3 + 658098423054303618211936394842433054629632148355581864298661*x**2 + 180767545670412292249655637241650859681554831261352253591473*x + 328727618918465900241876749242248711072761081420664765183639)

class Lollipop489201Point(PointWeierstrass):
      
        def fast_scalar_mul(self, n):
            psiP = self.psi()
            beta = vector([n,0]) * self.curve.N_inv
            b = vector([int(beta[0]), int(beta[1])]) * self.curve.N
            k1 = n-b[0]
            k2 = -b[1]
            return self.multi_scalar_mul(k1, psiP, k2)